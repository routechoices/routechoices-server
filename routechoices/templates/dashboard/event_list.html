{% extends "dashboard/home.html" %}
{% load static %}
{% load hosts %}
{% load django_bootstrap5 %}

{% block sub_content %}
<div class="row">
    <div class="col-12">
        <a href="{% url 'dashboard:event_create_view'%}" class="btn btn-primary">Create new event</a>
        <h1>Your Clubs Events</h1>
        {% if not events %}
            <p>You haven't created any event yet.</p>
        {% else %}
        <table class="table table-striped">
            <tr>
                <th>Name</th>
                <th>Start Date</th>
                <th>Privacy</th>
                <th>Is Live</th>
                <th>Club</th>
                <th>Actions</th>
            </tr>
            {% for event in events %}
            <tr>
                <td><a href="{% url 'dashboard:event_edit_view' id=event.aid %}">{{ event.name }}</a></td>
                <td><span class="date-utc" data-date="{{ event.start_date|date:'c' }}">{{ event.start_date|date:'Y-m-d H:i:s' }} UTC</span></td>
                <td>{{ event.get_privacy_display }}</a></td>
                <td>{% if event.is_live %}<i style="color:green" class="fa fa-check-circle"></i>{% else %}<i style="color:red" class="fa fa-times-circle"></i>{% endif %}</a></td>
                <td>{{ event.club }}</td>
                <td>
                    <a href="{{ event.get_absolute_url }}" class="btn btn-primary" style="margin-bottom: 2px"><i class="fa fa-sign-in"></i> Open</a>
                    {% if not event.ended and event.open_registration %} <a href="{{event.club.nice_url}}{{event.slug}}/registration" class="btn btn-secondary" style="margin-bottom: 2px"><i class="fa fa-user-plus"></i> Registration Page</a>{% endif %}
                    {% if event.started and event.allow_route_upload %} <a href="{{event.club.nice_url}}{{event.slug}}/route_upload" class="btn btn-secondary" style="margin-bottom: 2px"><i class="fa fa-upload"></i> Route Upload Page</a>{% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
        {% bootstrap_pagination events extra=request.GET.urlencode %}
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_body %}
{{ block.super }}
<script src="{% static '/vendor/dayjs-1.10.6/dayjs.min.js' %}"></script>
<script>
$(function(){
    $('.date-utc').each(function(i, el){
        $el = $(el);
        $el.text(dayjs($el.data('date')).local().format('YYYY-MM-DD HH:mm:ss'));
    });
})
</script>
{% endblock %}
