{% extends "dashboard/club_view.html" %}
{% load static %}
{% load hosts %}
{% load django_bootstrap5 %}
{% load compress %}

{% block sub_sub_content %}
<div class="row">
    <div class="col-12">

        {% if not events %}
            <p>You haven't created any events yet.</p>
            <a href="{% url 'dashboard:event_create_view'%}" class="btn btn-primary"><i class="fa fa-plus"></i> Create new event</a>
        {% else %}
        <div style="margin-bottom:15px"><a href="{% url 'dashboard:event_create_view'%}" class="btn btn-primary"><i class="fa fa-plus"></i> Create new event</a></div>
        {% if events.paginator.num_pages > 1 %}{% bootstrap_pagination events extra=request.GET.urlencode %}{% endif %}
        <table class="table table-striped">
            <tr>
                <th>Name</th>
                <th>Set</th>
                <th>Start Date</th>
                <th>Privacy</th>
                <th>Is Live</th>
                <th>Actions</th>
            </tr>
            {% for event in events %}
            <tr>
                <td><a href="{% url 'dashboard:event_edit_view' event_id=event.aid %}">{{ event.name }}</a></td>
                <td>{% if event.event_set %}{{ event.event_set }}{% else %}-{% endif %}</td>
                <td><span class="date-utc" data-date="{{ event.start_date|date:'c' }}" style="white-space: nowrap;font-variant-numeric: tabular-nums;">{{ event.start_date|date:'Y-m-d H:i:s' }} UTC</span></td>
                <td><span style="white-space: nowrap;"><i class="fa fa-{% if event.privacy == 'public' %}users{% elif event.privacy == 'secret'%}user-secret{% else %}ban{% endif %}"></i> {{ event.get_privacy_display }}</a></span></td>
                <td>{% if event.is_live %}<i style="color:green" class="fa fa-check-circle"></i>{% else %}<i style="color:red" class="fa fa-times-circle"></i>{% endif %}</a></td>
                <td>
                    <a href="{{ event.get_absolute_url }}" class="btn btn-primary btn-sm" style="margin-bottom: 2px"><i class="fa fa-sign-in"></i> View</a>
                    {% if not event.hidden %}<a href="{{event.club.nice_url}}{{event.slug}}/export" class="btn btn-sm btn-secondary" style="margin-bottom: 3px"><i class="fa fa-save"></i> Export</a>{% endif %}
                    {% if event.started and event.allow_route_upload or event.open_registration and not event.ended  %}
                        <a href="{{event.club.nice_url}}{{event.slug}}/contribute" class="btn btn-sm btn-secondary" style="margin-bottom: 3px"><i class="fa fa-circle-plus"></i> Competitor{% if event.open_registration and not event.ended %} registration{% endif %}{% if event.open_registration and event.allow_route_upload and event.started and not event.ended %} or{% endif %}{% if event.started and event.allow_route_upload %} route upload{% endif %}</a>
                    {% endif %}
                    {% if event.ended and event.map_id %}<a href="http://3drerun.worldofo.com/2d/?server={{ site.domain }}/api/woo&eventid={{event.aid}}&liveid=-" target="_blank" rel="noopener noreferrer" class="btn btn-sm btn-secondary " style="margin-bottom: 3px"><i class="fa fa-external-link" aria-hidden="true"></i> 2DRerun</a>{% endif %}
                    {% if event.is_live %} <a href="{% url 'dashboard:event_view_live' event_id=event.aid %}" class="btn btn-secondary btn-sm" style="margin-bottom: 2px"><i class="fa fa-bolt"></i> No Delay Live (Admin Only)</a>{% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
        {% if events.paginator.num_pages > 1 %}{% bootstrap_pagination events extra=request.GET.urlencode %}{% endif %}
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_body %}
{{ block.super }}
{% compress js %}
<script src="{% static '/vendor/umbrella-3.3.0/umbrella.min.js' %}"></script>
<script src="{% static '/vendor/dayjs-1.10.6/dayjs.min.js' %}"></script>
<script src="{% static '/scripts/dashboard/event_list.js' %}"></script>
{% endcompress %}
{% endblock %}
