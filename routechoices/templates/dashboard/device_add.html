{% extends "dashboard/home.html" %}
{% load static %}
{% load django_bootstrap5 %}
{% load hosts %}
{%  block extra_head %}
{{ block.super }}
<link rel="stylesheet" href="{% static '/vendor/selectize-0.13.3/selectize.bootstrap5.css' %}" />
{%  endblock %}

{% block sub_content %}
<div class="row">
    <div class="col-12">
        <h1>Add your device</h1>
        <form action="" method="post">
            {% csrf_token %}
            {% bootstrap_form form %}
            <input type="submit" value="Add" class="btn btn-primary">
        </form>
    </div>
</div>
{% endblock %}

{% block extra_body %}
{{ block.super }}
<script src="{%  static '/vendor/selectize-0.13.3/selectize.min.js' %}"></script>
<script>

</script>
<script>
$('#id_device').selectize({
    valueField: 'id',
    labelField: 'device_id',
    searchField: 'device_id',
    multiple: true,
    create: false,
    plugins: [ 'preserve_on_blur' ],
    load: function(query, callback) {
        if (!query.length || query.length < 2) return callback();
        $.ajax({
            url: '{% host_url "device_search_api" host "api" %}?q=' + encodeURIComponent(query),
            type: 'GET',
            error: function() {
                callback();
            },
            success: function(res) {
                callback(res.results);
            }
        });
    }
});
</script>
{%  endblock %}