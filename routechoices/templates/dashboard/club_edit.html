{% extends "dashboard/home.html" %}
{% load static %}
{% load django_bootstrap5 %}
{% load hosts %}
{%  block extra_head %}
{{ block.super }}
<link rel="stylesheet" href="{% static '/vendor/selectize-0.13.3/selectize.bootstrap5.css' %}" />
{%  endblock %}

{% block sub_content %}
<div class="row">
    <div class="col-12">
        <h1>{% if context == 'edit' %}Edit Club{% else %}New CLub{% endif %}</h1>
        <form action="" method="post">
            {% csrf_token %}
            {% bootstrap_form form %}
            <input type="submit" value="Save" class="btn btn-primary">
            {% if context == 'edit' %}<a href="{% url 'dashboard:club_delete_view' id=club.aid %}" class="btn btn-danger">Delete</a>{% endif %}
        </form>
    </div>
</div>
{% endblock %}

{% block extra_body %}
{{ block.super }}
<script src="{% static '/vendor/selectize-0.13.3/selectize.min.js' %}"></script>
<script>
{% if context != 'edit' %}
$('#id_slug').parent().find('.form-text').text('.routechoices.com')
{% endif %}
$('#id_admins').selectize({
    valueField: 'id',
    labelField: 'username',
    searchField: 'username',
    multiple: true,
    create: false,
    plugins: [ 'preserve_on_blur' ],
    load: function(query, callback) {
        if (!query.length || query.length < 2) return callback();
        $.ajax({
            url: '{% host_url "user_search_api" host "api" %}?q=' + encodeURIComponent(query),
            type: 'GET',
            xhrFields: {
                withCredentials: true
            },
            crossDomain: true,
            error: function() {
                callback();
            },
            success: function(res) {
                callback(res.results);
            }
        });
    }
});
</script>
{%  endblock %}