{% extends "club/base.html" %}
{% load static %}
{% load hosts %}
{% load compress %}

{% block head_title %}{{ event.name }} data export | Powered by {{ site.name }}{% endblock %}
{% block head_description %}{{ event.name }} by {{ event.club.name }} data export page{% endblock %}

{% block contentup %}
<div class="container-fluid p-0">
  <div class="row m-0">
    <div class="w-100" style="background-color: #fff;">
      <div class="container content">
        <div class="row">
          {% if event.event_set %}<h2 class="padded-multiline"><span>{{ event.event_set.name }}</span></h2>{% endif %}
          <h2><a href="{{event.club.nice_url}}{{event.slug}}">{{ event.name }}</a></h2>
          <h4>Export event data</h4>
        </div>
      </div>
    </div>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1 1" width="100%" height="2em" preserveAspectRatio="none" fill="#f8f9fa" style="margin-top: -2em;" class="p-0"><path d="M0 1 L1 1 L0 0 Z"/></svg>
  </div>
</div>
<div class="container content">
  <div class="row">
    {% if not event.started %}
    <div class="text-center">
      <h3>Export is not available yet...</h3>
    </div>
    {% else %}
    {% if event.map_id  %}
    <h4 class="padded-multiline"><span>Maps</span></h4>
    <div class="row">
      <div class="col-12 col-sm-6 col-md-3 mb-3">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">{% if event.map_title %}{{ event.map_title }}{% else %}Main map{% endif %}</h5>
            <a href="{{event.club.nice_url}}{{event.slug}}/map/" class="btn btn-sm btn-primary mb-1"><i class="fa-solid fa-download"></i> Image</a>
            <a href="{{event.club.nice_url}}{{event.slug}}/kmz/" class="btn btn-sm btn-primary mb-1"><i class="fa-solid fa-download"></i> KMZ</a>
          </div>
        </div>
      </div>
      {% for map in event.map_assignations.all %}
      <div class="col-12 col-sm-6 col-md-3 mb-3">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">{{ map.title }}</h5>
            <a href="{{event.club.nice_url}}{{event.slug}}/map/{{forloop.counter|add:1}}" class="btn btn-sm btn-primary mb-1"><i class="fa-solid fa-download"></i> Image</a>
            <a href="{{event.club.nice_url}}{{event.slug}}/kmz/{{forloop.counter|add:1}}" class="btn btn-sm btn-primary mb-1"><i class="fa-solid fa-download"></i> KMZ</a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    {% if event.competitors.all and event.started %}
    <h4 class="padded-multiline"><span>Competitors</span></h4>
    <div class="row">
      {% for competitor in event.competitors.all %}
      <div class="col-12 col-sm-6 col-md-3 mb-3">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">{{ competitor.name }}</h5>
            <a href="{{ competitor.get_absolute_gpx_url }}" class="btn btn-sm btn-primary mb-1"><i class="fa-solid fa-download"></i> GPX</a>
            {% if event.map %}
            <a href="https://mapdump.com/new#title={{ event.name|urlencode }}%20-%20{{competitor.name|urlencode}}&kmz=https:{% host_url 'event_kmz_download' event_id=event.aid host 'api' %}&gpx=https:{% host_url 'competitor_gpx_download' competitor_id=competitor.aid host 'api' %}" class="btn btn-sm btn-primary mb-1" target="_blank" rel="noopener noreferrer"><i class="fa-solid fa-arrow-up-right-from-square"></i> MapDump.com</a>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}
    {% endif %}
  </div>
</div>
{% endblock %}

{% block extra_body %}
{{ block.super }}
{% compress js %}
<script src="{% static '/vendor/umbrella-3.3.1/umbrella.min.js' %}"></script>
<script src="{% static '/vendor/dayjs-1.11.7/dayjs.min.js' %}"></script>
<script src="{% static '/scripts/club/event_export.js' %}"></script>
{% endcompress %}
{% endblock %}
